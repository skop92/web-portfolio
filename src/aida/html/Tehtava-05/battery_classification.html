
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Usean mallin luokittelua akkujärjestelmille &#8212; Solar panel data project</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Random Forest Classifier" href="rfc_model.html" />
    <link rel="prev" title="Naive Bayes -luokittelua akkujärjestelmille" href="../Tehtava-04/naive_bayes_batteries.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Solar panel data project</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../docs/70-Jupyter-Book/index.html">
                    Solar panel data project
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Data-analyysi
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Tehtava-03/paneelivalmistaja_asentaja_visualisointi.html">
   Valmistajat ja asentajat
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Tehtava-03/esik_total_installed_price.html">
   Hintojen tutkiminen
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Tehtava-03/price_trends.html">
   Hintakehitys
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Tehtava-03/esik_system_size_DC.html">
   Sähkötehon tutkiminen
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Tehtava-03/system_size_trend.html">
   Sähkötehon kehitys
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../docs/70-Jupyter-Book/kartat.html">
   Karttalinkit
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Tehtava-03/solar_panel_technologies.html">
   Aurinkopaneeleiden teknologiat
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Esikäsittelijä
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../docs/40-Datan-kuvaus-ja-esik%C3%A4sittely/preprocessor_dokumentointi.html">
   Esikäsittelijän dokumentaatio
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../docs/70-Jupyter-Book/esikasittelijan_testit.html">
   Esikäsittelijän testit
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../tests/self_defined_cols_test.html">
     Itse määritellyt sarakkeet
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tests/price_preprocessor_test.html">
     Asennuksen hinta
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tests/size_preprocessor_test.html">
     Järjestelmän sähköteho
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Koneoppiminen
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../docs/70-Jupyter-Book/akkuluokittelu.html">
   Akkuluokittelu
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="../Tehtava-04/naive_bayes_batteries.html">
     Naive Bayes -luokittelua akkujärjestelmille
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Usean mallin luokittelua akkujärjestelmille
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="rfc_model.html">
   Random Forest Classifier
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="ML_analyysi.html">
     Aurinkopaneli pisteytys koneoppimisen haasteet.
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="klusteroinnin_analysointia.html">
   Asennusten maantieteellinen klusterointi
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../docs/70-Jupyter-Book/aikasarja.html">
   Asennusmäärän ennustaminen
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../docs/50-Koneoppiminen/asennusten_aikasarjaennustus_final.html">
     Asennusmäärän ennustaminen
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="asennusten_aikasarjaennustus_valikoitu.html">
     Asennusmäärän ennustaminen vertaamalla vuoden takaiseen
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Malli tuotantoon
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Tehtava-06/mallit_tuotantoon.html">
   Mallit tuotantoon
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../docs/70-Jupyter-Book/mercury_src.html">
   Mercury lähdekoodit
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Tehtava-06/Mercury_clustering.html">
     Mercury clustering
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Tehtava-06/Mercury_RFC_SPC.html">
     ML test GUI for Random Forest Classifier
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/Tehtava-05/battery_classification.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/Tehtava-05/battery_classification.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#kirjastot">
   Kirjastot
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#esikasittelijan-ajaminen">
   Esikäsittelijän ajaminen
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#datan-kasittely-malleja-varten">
   Datan käsittely malleja varten
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#suodatus">
     Suodatus
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#suodatuksen-tulos">
     Suodatuksen tulos
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sarakkeiden-muokkaus">
     Sarakkeiden muokkaus
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#opetus-ja-testiaineisto">
   Opetus- ja testiaineisto
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#luokittelijat">
   Luokittelijat
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#mallien-ajo">
   Mallien ajo
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#alustava-tulkinta-tarkkuudesta">
     Alustava tulkinta tarkkuudesta
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#hintajakaumat">
     Hintajakaumat
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#hintajakaumien-tulkintaa">
     Hintajakaumien tulkintaa
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#tiheyskayrat-ja-hajontakaaviot">
   Tiheyskäyrät ja hajontakaaviot
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gaussian-nb-ja-complement-nb">
     Gaussian NB ja Complement NB
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#knn-decision-tree-ja-random-forest">
     kNN, Decision Tree ja Random Forest
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Usean mallin luokittelua akkujärjestelmille</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#kirjastot">
   Kirjastot
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#esikasittelijan-ajaminen">
   Esikäsittelijän ajaminen
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#datan-kasittely-malleja-varten">
   Datan käsittely malleja varten
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#suodatus">
     Suodatus
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#suodatuksen-tulos">
     Suodatuksen tulos
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sarakkeiden-muokkaus">
     Sarakkeiden muokkaus
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#opetus-ja-testiaineisto">
   Opetus- ja testiaineisto
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#luokittelijat">
   Luokittelijat
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#mallien-ajo">
   Mallien ajo
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#alustava-tulkinta-tarkkuudesta">
     Alustava tulkinta tarkkuudesta
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#hintajakaumat">
     Hintajakaumat
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#hintajakaumien-tulkintaa">
     Hintajakaumien tulkintaa
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#tiheyskayrat-ja-hajontakaaviot">
   Tiheyskäyrät ja hajontakaaviot
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gaussian-nb-ja-complement-nb">
     Gaussian NB ja Complement NB
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#knn-decision-tree-ja-random-forest">
     kNN, Decision Tree ja Random Forest
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="usean-mallin-luokittelua-akkujarjestelmille">
<h1>Usean mallin luokittelua akkujärjestelmille<a class="headerlink" href="#usean-mallin-luokittelua-akkujarjestelmille" title="Permalink to this headline">#</a></h1>
<p>Tämä versio on kehitetty tehtävän 4 aikana tehdystä luokittelusta. Tällä kertaa tavoitteena ei ole löytää lisää järjestelmiä, joissa voisi olla koneoppimisen perusteella akku, vaan tavoitteena on saada mallit luokittelemaan järjestelmät mahdollisimman tarkasti niille annetusta datasta.</p>
<p>Kaikkia tämän tutkimuksen aikana tehtyjä löydöksiä, joista osa on myös vaikuttanut dokumentin muotoutumiseen, ei ole perusteellisesti dokumentoitu tähän, mikä lopulta helpottanee tärkeiksi katsottuihin asioihin keskittymistä.</p>
<section id="kirjastot">
<h2>Kirjastot<a class="headerlink" href="#kirjastot" title="Permalink to this headline">#</a></h2>
<p>Kirjastoissa mukana myös itse koodattu esikäsittelijä.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">from</span> <span class="nn">sklearn.naive_bayes</span> <span class="kn">import</span> <span class="n">GaussianNB</span>
<span class="kn">from</span> <span class="nn">sklearn.naive_bayes</span> <span class="kn">import</span> <span class="n">ComplementNB</span>
<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span><span class="p">,</span> <span class="n">balanced_accuracy_score</span><span class="p">,</span> <span class="n">confusion_matrix</span><span class="p">,</span> <span class="n">ConfusionMatrixDisplay</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>

<span class="kn">import</span> <span class="nn">importlib.util</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">file_path</span> <span class="o">=</span> <span class="s2">&quot;../Tehtava-03/preprocessor.py&quot;</span><span class="p">;</span> <span class="n">module_name</span> <span class="o">=</span> <span class="s2">&quot;preprocessor&quot;</span><span class="p">;</span> <span class="n">spec</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">spec_from_file_location</span><span class="p">(</span><span class="n">module_name</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span>
<span class="n">esik</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">module_from_spec</span><span class="p">(</span><span class="n">spec</span><span class="p">);</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">module_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">esik</span><span class="p">;</span> <span class="n">spec</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">exec_module</span><span class="p">(</span><span class="n">esik</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="esikasittelijan-ajaminen">
<h2>Esikäsittelijän ajaminen<a class="headerlink" href="#esikasittelijan-ajaminen" title="Permalink to this headline">#</a></h2>
<p>Kutsutaan esikäsittelijää. Annetaan parametriksi myös ulkopuolisten omistamien (third party owned) asennusten hintojen poisto vertailukelpoisuuden mahdolliseksi parantamiseksi.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">price_col</span> <span class="o">=</span> <span class="s1">&#39;price_per_W&#39;</span>
<span class="n">customer_segment</span> <span class="o">=</span> <span class="s1">&#39;customer_segment&#39;</span>
<span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">price_col</span><span class="p">,</span> <span class="s1">&#39;inverter_loading_ratio&#39;</span><span class="p">,</span> <span class="s1">&#39;installer_name&#39;</span><span class="p">,</span> <span class="n">customer_segment</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;ground_mounted&#39;</span><span class="p">,</span> <span class="s1">&#39;tracking&#39;</span><span class="p">,</span> <span class="s1">&#39;new_construction&#39;</span><span class="p">,</span> <span class="s1">&#39;battery_storage&#39;</span><span class="p">]</span>

<span class="n">df_all</span> <span class="o">=</span> <span class="n">esik</span><span class="o">.</span><span class="n">esik</span><span class="p">(</span><span class="n">cols</span><span class="p">,</span> <span class="n">price_per_kW_limit</span><span class="o">=</span><span class="mi">2500</span><span class="p">,</span> <span class="n">no_tpo_prices</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;df_all.shape:&quot;</span><span class="p">,</span> <span class="n">df_all</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>df_all.shape: (1000000, 9)
</pre></div>
</div>
</div>
</div>
</section>
<section id="datan-kasittely-malleja-varten">
<h2>Datan käsittely malleja varten<a class="headerlink" href="#datan-kasittely-malleja-varten" title="Permalink to this headline">#</a></h2>
<p>Ennen koneoppimismallien ajoa dataa käsitellään kahdessa vaiheessa vielä esikäsittelijän käytön jälkeenkin. Ensin dataa suodatetaan, jotta laajasta joukosta saadaan valittua malleja ajatellen mahdollisimman hyvää ja vertailukelpoista dataa. Seuraavaksi data muokataan malleja varten. Käytännössä se tarkoittaa datan tekstikenttien muuttamista numeerisiksi.</p>
<p>Luokittelun perustana on hinta ja asentaja. Myös muiden piirteiden käyttöä mallien datassa testattiin. Testien perusteella mallien tarkkuus parani ottamalla mukaan invertterin kuormitussuhteen (inverter loading ratio), mikä oli pieni yllätys. Paneeliteknologian tyypin ja avustuksen tai verohyvityksen (rebate or grant) vaikutus tuloksiin tutkittiin myös, mutta ne eivät juuri muuttaneet tulosta, joten ne on jätetty tässä vaiheessa pois.</p>
<section id="suodatus">
<h3>Suodatus<a class="headerlink" href="#suodatus" title="Permalink to this headline">#</a></h3>
<p>Tehdään datalle useita suodatuksia, joilla parannetaan hintojen vertailukelpoisuutta.</p>
<p>Supistetaan testidataa rajaamalla se yhteen vuoteen ja yhteen asiakassegmenttiin. Joukosta poistetaan myös kalleimmat järjestelmät ja valitaan vain tietty määrä supistetun joukon yleisimpiä asentajia. Asentajat valitaan akkuasennusten osuuden perusteella (50 suurinta), jolloin akkujen osuus datassa nousee. Asentajien joukosta kuitenkin poistetaan Tesla Energy johtuen sen hinnoittelutavoista, jotka aiheuttavat ongelmia luokitteluun.</p>
<p>Hintojen vertailukelpoisuus paranee oletettavasti myös suodattamalla asennuksia muiden ominaisuuksien mukaan. Tässä ei ole huomioitu kaikkia mahdollisia ominaisuuksia, vaan osa, joilla saattaa olla vaikutusta hintaan. Nämä ominaisuudet ovat maahan asentaminen (ground mounted), paneelin kääntyminen valon suuntaan (tracking) ja järjestelmän asentaminen uuteen rakennukseen rakennusvaiheessa (new construction).</p>
<p>Tulos tallennetaan jatkoa varten nimellä <code class="docutils literal notranslate"><span class="pre">df_filt</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">top_installers_n</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">price_limit_quantile</span> <span class="o">=</span> <span class="mf">0.95</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df_all</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="n">price_col</span><span class="p">,</span> <span class="s1">&#39;installer_name&#39;</span><span class="p">,</span> <span class="s1">&#39;inverter_loading_ratio&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;dropna, df.shape:&quot;</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2019</span><span class="p">)]</span>  <span class="c1"># Ensimmäinen akku 2008</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;1-year, df.shape:&quot;</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="n">customer_segment</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;RES&#39;</span><span class="p">)]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;1-segment, df.shape:&quot;</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="n">price_q</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">price_col</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">price_limit_quantile</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%4.2f</span><span class="s2"> quantile: </span><span class="si">%5.3f</span><span class="s2"> $/W&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">price_limit_quantile</span><span class="p">,</span> <span class="n">price_q</span><span class="p">))</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="n">price_col</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">price_q</span><span class="p">)]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;price limit, df.shape:&quot;</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ground_mounted&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ground mounted, df.shape:&quot;</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;tracking&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;tracking, df.shape:&quot;</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;new_construction&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;new construction, df.shape:&quot;</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="n">installers</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;installer_name&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;battery_storage&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]})</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;battery_storage&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">),</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">top_installers_n</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="k">try</span><span class="p">:</span>
  <span class="n">installers</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;Tesla Energy&#39;</span><span class="p">)</span>
  <span class="n">top_installers_n</span> <span class="o">-=</span> <span class="mi">1</span>
<span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
  <span class="k">pass</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;installer_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">installers</span><span class="p">))]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">top_installers_n</span><span class="p">,</span> <span class="s2">&quot;top installers, df.shape:&quot;</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="n">akku_osuus</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;battery_storage&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Valitun joukon akkuosuus: </span><span class="si">{</span><span class="n">akku_osuus</span><span class="si">}</span><span class="s1"> %&#39;</span><span class="p">)</span>

<span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;battery_storage&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>
<span class="n">df_filt</span> <span class="o">=</span> <span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dropna, df.shape: (278338, 9)
1-year, df.shape: (56007, 9)
1-segment, df.shape: (55549, 9)
0.95 quantile: 6.072 $/W
price limit, df.shape: (52778, 9)
ground mounted, df.shape: (51500, 9)
tracking, df.shape: (51137, 9)
new construction, df.shape: (49354, 9)
49 top installers, df.shape: (5248, 9)
Valitun joukon akkuosuus: 16.6 %
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0    4378
1     870
Name: battery_storage, dtype: int64
</pre></div>
</div>
</div>
</div>
</section>
<section id="suodatuksen-tulos">
<h3>Suodatuksen tulos<a class="headerlink" href="#suodatuksen-tulos" title="Permalink to this headline">#</a></h3>
<p>Datan suodatuksen jälkeen tarkistetaan minkälaiselta se näyttää.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df_filt</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="n">price_col</span><span class="p">,</span> <span class="s1">&#39;inverter_loading_ratio&#39;</span><span class="p">,</span> <span class="s1">&#39;battery_storage&#39;</span><span class="p">]]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;df.shape:&quot;</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="n">rc</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;axes.grid&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span>
<span class="n">sns</span><span class="o">.</span><span class="n">pairplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;battery_storage&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>df.shape: (5248, 3)
</pre></div>
</div>
<img alt="../_images/battery_classification_7_1.png" src="../_images/battery_classification_7_1.png" />
</div>
</div>
<p>Ainakin hinnan jakauma näyttää juuri siltä miltä sen oletettiin näyttävän. Akkuasennuksia on yhä huomattavasti vähemmän, mutta ne näyttävät olevan keskimäärin kalliimpia.</p>
<p>Invertterin kuormitussuhteesta huomataan, että akuttomilla järjestelmillä lukema keskittyy hieman kapeammalle alueelle ja selvästi eniten arvoja on välillä 1,0 - 1,2. Akkujärjestelmillä jakauma on melko tasainen välillä 0,8 - 1,2. Ohjelmoijana on mahdotonta arvioida, onko tilanteen taustalla jotain teknistä syytekijää, mutta havainto selittänee osan siitä, miksi piirteen ottaminen mukaan parantaa mallien tarkkuutta.</p>
</section>
<section id="sarakkeiden-muokkaus">
<h3>Sarakkeiden muokkaus<a class="headerlink" href="#sarakkeiden-muokkaus" title="Permalink to this headline">#</a></h3>
<p>Tässä vaiheessa muokataan asentajasarake malleille sopivaan muotoon eli numeeriseksi. Tämä voidaan tehdä ainakin kahdella tavalla: korvataan asentajien nimet numerokoodein tai tehdään jokaiselle asentajalle oma sarake, jossa on numero 1 tai 0 riippuen siitä, onko asennus kyseisen asentajan tekemä vai ei. Menettely voi olla tarpeellinen Naive Bayes -luokittelijoille sekä kNN-luokittelijalle, mutta Random Forest ja Decision Tree näyttävät toimivat hyvin yhden sarakkeen numerokoodeillakin.</p>
<p>Vastaavat boolean-sarakkeet tehtiin myös paneeliteknologioille, mutta piirre jätettiin lopulta pois datasta sen osoittauduttua ylimääräiseksi tähän tehtävään.</p>
<p>Tulos tallennetaan jatkoa varten nimellä <code class="docutils literal notranslate"><span class="pre">df_ML</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df_filt</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># Nämä rivit tekevät asentajille omat sarakkeet</span>
<span class="c1">#df.rename(columns={&#39;installer_name&#39;: &#39;i&#39;}, inplace=True)</span>
<span class="c1">#df = pd.get_dummies(df, columns=[&#39;i&#39;])</span>

<span class="c1"># Tällä rivillä vaihtoehtoisesti numerokoodit</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;installer_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;installer_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">codes</span>


<span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;new_construction&#39;</span><span class="p">,</span> <span class="s1">&#39;tracking&#39;</span><span class="p">,</span> <span class="s1">&#39;ground_mounted&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="n">customer_segment</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;df.shape:&quot;</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="n">df_ML</span> <span class="o">=</span> <span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>df.shape: (5248, 4)
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>price_per_W</th>
      <th>inverter_loading_ratio</th>
      <th>installer_name</th>
      <th>battery_storage</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>177</th>
      <td>3.636388</td>
      <td>1.312500</td>
      <td>40</td>
      <td>0</td>
    </tr>
    <tr>
      <th>183</th>
      <td>4.262500</td>
      <td>1.208333</td>
      <td>39</td>
      <td>0</td>
    </tr>
    <tr>
      <th>317</th>
      <td>3.914099</td>
      <td>1.188000</td>
      <td>39</td>
      <td>0</td>
    </tr>
    <tr>
      <th>373</th>
      <td>4.125616</td>
      <td>1.127778</td>
      <td>23</td>
      <td>0</td>
    </tr>
    <tr>
      <th>384</th>
      <td>5.617535</td>
      <td>0.756303</td>
      <td>20</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section id="opetus-ja-testiaineisto">
<h2>Opetus- ja testiaineisto<a class="headerlink" href="#opetus-ja-testiaineisto" title="Permalink to this headline">#</a></h2>
<p>Jaetaan edellä valikoitu data opetus- ja testiaineistoon 70-30 jaolla. Malleille menevä data skaalataan välille [0, 1]. Alkuperäiset arvot säilytetään myöhempää käyttöä varten.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df_ML</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;battery_storage&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;battery_storage&#39;</span><span class="p">]</span>
<span class="n">X_cols</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span>
<span class="n">random_state</span> <span class="o">=</span> <span class="mi">5451</span>

<span class="n">X_train_orig</span><span class="p">,</span> <span class="n">X_test_orig</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>

<span class="n">mms</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_orig</span><span class="p">)</span>

<span class="n">X_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">mms</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_train_orig</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="n">X_cols</span><span class="p">)</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">mms</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test_orig</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="n">X_cols</span><span class="p">)</span>

<span class="n">X_train</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>price_per_W</th>
      <th>inverter_loading_ratio</th>
      <th>installer_name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.518716</td>
      <td>0.401840</td>
      <td>0.812500</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.105436</td>
      <td>0.639644</td>
      <td>0.416667</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.700854</td>
      <td>0.498738</td>
      <td>0.333333</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.161661</td>
      <td>0.854196</td>
      <td>0.145833</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.536769</td>
      <td>0.394064</td>
      <td>0.604167</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="luokittelijat">
<h2>Luokittelijat<a class="headerlink" href="#luokittelijat" title="Permalink to this headline">#</a></h2>
<p>Seuraavaksi valitaan luokittelijat ja määritetään niille muutama parametri käyttäen muuten niiden oletusarvoja. Yhtenä jatkokehityskohteena tässä mallinnuksessa olisi parametrien säätö parempiin arvoihin, jolloin mallien tarkkuus saattaisi olla jonkin verran parempi.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s1">&#39;Gaussian NB&#39;</span><span class="p">,</span>
  <span class="s1">&#39;Complement NB&#39;</span><span class="p">,</span>
  <span class="s1">&#39;k Nearest Neighbors&#39;</span><span class="p">,</span>
  <span class="s1">&#39;Decision Tree&#39;</span><span class="p">,</span>
  <span class="s1">&#39;Random Forest&#39;</span>
<span class="p">]</span>

<span class="n">classifiers</span> <span class="o">=</span> <span class="p">[</span>
  <span class="n">GaussianNB</span><span class="p">(),</span>
  <span class="n">ComplementNB</span><span class="p">(),</span>
  <span class="n">KNeighborsClassifier</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
  <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">),</span>
  <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="mallien-ajo">
<h2>Mallien ajo<a class="headerlink" href="#mallien-ajo" title="Permalink to this headline">#</a></h2>
<p>Valituilla malleilla on hyvin yhtenevät funktiot, mikä helpottaa mallien ajamista silmukassa, joten niin on myös tehty. Jokaiselle mallille on laskettu tarkkuus kahdella tavalla, koska epätasapaino akuttomien ja akullisten järjestelmien määrissä on suuri. Jälkimmäinen tarkkuus ottaa paremmin huomioon kuinka monta akkujärjestelmää tunnistetaan tai jää tunnistamatta.</p>
<p>Mallien ajon jälkeen hinnan jakaumista piirretään kuvaajat kullekin mallille ja alkuperäiselle testidatalle. Tätä varten silmukassa kootaan DataFrame <code class="docutils literal notranslate"><span class="pre">df_d</span></code> apumuuttujan <code class="docutils literal notranslate"><span class="pre">df_temp</span></code> avulla. Lisäksi päätöspuita käyttävien mallien tuottamat tiedot piirteiden tärkeydestä kootaan <code class="docutils literal notranslate"><span class="pre">df_i</span></code>:hin.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="s1">&#39;model&#39;</span>              <span class="c1"># Nimi model-sarakkeelle</span>
<span class="n">orig</span> <span class="o">=</span> <span class="s1">&#39;Original test data&#39;</span>  <span class="c1"># Testiaineiston tunnistusta varten</span>
<span class="n">ind</span> <span class="o">=</span> <span class="n">X_test_orig</span><span class="o">.</span><span class="n">index</span>      <span class="c1"># Kopioidaan indeksi liitettäväksi ennusteisiin</span>

<span class="n">df_d</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">X_test_orig</span><span class="p">,</span> <span class="n">y_test</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">akku_osuus_test</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">df_d</span><span class="p">[</span><span class="s1">&#39;battery_storage&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">df_d</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="n">orig</span>
<span class="n">df_i</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">acc_range</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;vmin&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;vmax&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>  <span class="c1"># Teoreettiset min ja max arvot sekaannusmatriiseissa</span>


<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">classifiers</span><span class="p">),</span> <span class="n">layout</span><span class="o">=</span><span class="s2">&quot;constrained&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">clf</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">classifiers</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">classifiers</span><span class="p">))):</span>
  <span class="n">y_pred</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

  <span class="n">acs</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
  <span class="n">bacs</span> <span class="o">=</span> <span class="n">balanced_accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
  <span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">clf</span><span class="o">.</span><span class="n">classes_</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">)</span>

  <span class="n">ConfusionMatrixDisplay</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="o">=</span><span class="n">cm</span><span class="p">,</span> <span class="n">display_labels</span><span class="o">=</span><span class="n">clf</span><span class="o">.</span><span class="n">classes_</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Blues</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">im_kw</span><span class="o">=</span><span class="n">acc_range</span><span class="p">)</span>
  <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="se">\n</span><span class="s1">Accuracy: </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">acs</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s1"> %</span><span class="se">\n</span><span class="s1">Balanced: </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">bacs</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s1"> %&#39;</span><span class="p">)</span>  <span class="c1">#\nMean acc: {round((acs + bacs) * 50, 1)} %&#39;)</span>

  <span class="n">df_temp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">X_test_orig</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">ind</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;battery_storage&#39;</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">df_temp</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
  <span class="n">df_d</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_d</span><span class="p">,</span> <span class="n">df_temp</span><span class="p">])</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;Random Forest&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;Decision Tree&#39;</span><span class="p">):</span>
    <span class="n">importances</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">feature_importances_</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">importances</span><span class="p">)):</span>
      <span class="n">df_i</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">name</span><span class="p">,</span> <span class="n">X_cols</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> <span class="n">importances</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>


<span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&#39;&#39;Luokittelijoiden tarkkuudet ja sekaannusmatriisit</span>
<span class="s1">Akkujärjestelmien osuus (testidata) </span><span class="si">{</span><span class="n">akku_osuus_test</span><span class="si">}</span><span class="s1"> %</span>
<span class="s1">&#39;&#39;&#39;</span>

<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.titlesize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;x-large&#39;</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">display</span><span class="p">(</span><span class="n">df_i</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/battery_classification_16_0.png" src="../_images/battery_classification_16_0.png" />
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>price_per_W</th>
      <th>inverter_loading_ratio</th>
      <th>installer_name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Decision Tree</th>
      <td>0.685774</td>
      <td>0.210096</td>
      <td>0.104130</td>
    </tr>
    <tr>
      <th>Random Forest</th>
      <td>0.602849</td>
      <td>0.296340</td>
      <td>0.100811</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<section id="alustava-tulkinta-tarkkuudesta">
<h3>Alustava tulkinta tarkkuudesta<a class="headerlink" href="#alustava-tulkinta-tarkkuudesta" title="Permalink to this headline">#</a></h3>
<p>Ilman parempien hyper-parametrien hakemista tarkimmaksi luokittelijaksi osoittautuu Random Forest. Sen tarkkuuksien arvot ovat korkeimmat. Complement NB luokittelee kyllä eniten akkujärjestelmiä oikein, mutta samalla akuttomia luokitellaan verraten paljon virheellisesti, jolloin luokittelijan toimivuus on kokonaisuudessaan joukon heikommasta päästä.</p>
<p>Mallien kyky luokitella akkujärjestelmiä oikein ei yllä hyvälle tasolle, mutta data huomioiden tulos oli ehkä odotettukin.</p>
<p>Päätöspuuta käyttävien mallien palaute piirteiden suhteellisesta tärkeydestä ei välttämättä kerro mitään muiden mallien toiminnasta, mutta tärkeydet ainakin hinnan osalta tuntuvat loogisilta. Tuloksen selkeys kertoo vähän myös siitä, että data on onnistuttu suodattamaan malleja varten. Toisenlaisella suodatuksella asentajan vaikutus saattaisi olla korkeampi, esimerkiksi jos mukana olisi asentajia, jotka eivät olisi tehneet akkujärjestelmien asennuksia. Omassa analyysissä jää arvoitukseksi, onko Random Forest tarkempi juuri korkeamman invertterin kuormitussuhteen tärkeyden vuoksi.</p>
</section>
<section id="hintajakaumat">
<h3>Hintajakaumat<a class="headerlink" href="#hintajakaumat" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="n">rc</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;axes.grid&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
<span class="n">sns</span><span class="o">.</span><span class="n">displot</span><span class="p">(</span>
  <span class="n">df_d</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">price_col</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="s1">&#39;battery_storage&#39;</span><span class="p">,</span>
  <span class="n">binwidth</span><span class="o">=</span><span class="mf">.1</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">facet_kws</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">margin_titles</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/battery_classification_18_0.png" src="../_images/battery_classification_18_0.png" />
</div>
</div>
</section>
<section id="hintajakaumien-tulkintaa">
<h3>Hintajakaumien tulkintaa<a class="headerlink" href="#hintajakaumien-tulkintaa" title="Permalink to this headline">#</a></h3>
<p>Kaikki mallit toimivat vähintään kohtalaisesti näiden tärkeiksi katsottujen hintajakaumien perusteella. Hintaperuste näkyy erityisen selvästi Naive Bayes -luokittelijoilla, sillä ne luokittelevat yli 5 $/W maksavat järjestelmät lähes poikkeuksetta akullisiksi. Lisäksi Gaussian-luokittelijalla on melko heikko kyky tunnistaa halvempia akkujärjestelmiä. Toisaalta eniten oikeita akkuja tunnistanut Complement-luokittelija näyttää saavuttaneen tuloksensa luokittelemalla suhteettoman paljon järjestelmiä akullisiksi huonontaen kokonaistarkkuutta.</p>
<p>Muiden mallien kohdalla tarkempaa analyysiä on vaikea tehdä näiden kuvaajien perusteella, sillä tulos on kohtalaisen tarkka.</p>
<p>Näitä kuvaajia tulkitessa on toki hyvä muistaa, että pelkkä palkkien korkeus ei kerro koko totuutta mallien hyvyydestä, jos esimerkiksi jossain hintahaarukassa luokittelut ovat määrällisesti täsmällisiä, mutta menevät ikään kuin päittäin väärin päin.</p>
</section>
</section>
<section id="tiheyskayrat-ja-hajontakaaviot">
<h2>Tiheyskäyrät ja hajontakaaviot<a class="headerlink" href="#tiheyskayrat-ja-hajontakaaviot" title="Permalink to this headline">#</a></h2>
<p>Analyysin jatkamiseksi piirretään lisää kuvaajia. Seuraavissa kuvaajissa on mukana myös hieman yllättäen vaikuttavaksi piirteeksi paljastunut invertterin kuormitussuhde (inverter loading ratio). Hinta pysyy edelleen toisena kuvaajien piirteenä.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">models</span> <span class="o">=</span> <span class="n">names</span><span class="p">[:]</span>
<span class="n">models</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">orig</span><span class="p">)</span>

<span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="n">rc</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;axes.grid&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">models</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="s2">&quot;constrained&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="n">legend_display</span> <span class="o">=</span> <span class="kc">True</span>

<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">models</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">models</span><span class="p">))):</span>
  <span class="n">df</span> <span class="o">=</span> <span class="n">df_d</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
  <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">==</span> <span class="n">name</span><span class="p">)]</span>
  <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
  <span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">price_col</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;inverter_loading_ratio&quot;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;battery_storage&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">legend</span><span class="o">=</span><span class="n">legend_display</span><span class="p">)</span>
  <span class="n">legend_display</span> <span class="o">=</span> <span class="kc">False</span>
  <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">price_col</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;inverter_loading_ratio&quot;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;battery_storage&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">legend</span><span class="o">=</span><span class="n">legend_display</span><span class="p">)</span>


<span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&#39;&#39;Luokiteltujen pisteiden tiheyskäyrät ja hajontakaaviot</span>
<span class="s1">&#39;&#39;&#39;</span>

<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/battery_classification_21_0.png" src="../_images/battery_classification_21_0.png" />
</div>
</div>
<section id="gaussian-nb-ja-complement-nb">
<h3>Gaussian NB ja Complement NB<a class="headerlink" href="#gaussian-nb-ja-complement-nb" title="Permalink to this headline">#</a></h3>
<p>Valittujen Naive Bayes -luokittelijoiden luonne näkyy yllä olevissa kuvaajissa jo selkeästi, vaikka asentajan vaikutusta niissä ei näy. Pistejoukko jakautuu melko puhtaasti kahteen puoleen. Puolien rajat ovat jopa tunnistettavissa, jos kuvia verrataan muiden mallien kuviin. Mallit toimivat siis huonosti, jos datassa eri luokkiin kuuluvat pisteet levittäytyvät samalle alueelle ja tiheyskäyrät menevät oikeassa datassa selvästi päällekkäin.</p>
<p>Toisaalta mallien kehno tarkkuus voi johtua mallien tavasta käsitellä kuvaajien ulkopuolelle jätetty piirre eli asentaja. Asentaja on kuitenkin lopulta kategorinen muuttuja eikä sen numeerinen arvo kerro mistään todellisesta järjestelmän ominaisuudesta. Edellä laskettujen tarkkuuksien mukaan muut mallit selviävät tästä huolimatta luokittelusta edes vähän paremmin.</p>
<p>Jos asentaja haluttaisiin huomioida näillä malleilla mahdollisimman tarkasti, mallit tulisi ajaa jokaiselle asentajalle erikseen, jolloin koko piirre voitaisiin käytännössä jättää pois opetus- ja testiaineistosta.</p>
</section>
<section id="knn-decision-tree-ja-random-forest">
<h3>kNN, Decision Tree ja Random Forest<a class="headerlink" href="#knn-decision-tree-ja-random-forest" title="Permalink to this headline">#</a></h3>
<p>Yhtenä huomion arvoisena asiana kuvaajista nousee esiin tarkimpien mallien kohdalla sisimpien tiheyskäyrien piirtyminen hyvin samankaltaisina kuin oikeassa testiaineistossa. Ulommat käyrät vaihtelevat enemmän, mikä voisi viitata siihen, että “laidoilla” ja sitä myöten väljemmällä alueella olevien pisteiden luokittelu on malleille vaikeaa. Toisaalta tiheyskäyrien piirtäminen jo itsessään karsii poikkeavien arvojen näkyvyyttä, jolloin asiaan on hankalampaa ottaa kantaa.</p>
<p>Mielenkiintoisena yksityiskohtana mainittakoon vielä lähimpänä kuvion keskikohtaa oleva akkujärjestelmien uloin tiheyskäyrä. Vaikka se oikeassa datassa kulkee melko suoraan, ja vähän akuttomien sisimmän tiheyskäyrän päältä, niin kNN, Decision Tree kuin Random Forest eivät onnistu piirtämään (eli luokittelemaan) kyseistä kohtaa tarkasti. Tämä voi johtua siitä, että kyseisellä alueella invertterin kuormitussuhteen lukemasta on erityisen vähän hyötyä luokittelussa, koska niin monta järjestelmää on lähellä samoja arvoja. Osittain samasta syystä voi johtua akuttomien uloimman käyrän epätarkkuus invertterin kuormitussuhteen tyypillisillä arvoilla (1,0 - 1,2), vaikka käyrä on muutenkin melko epätarkka, kun hinta on yli 4 $/W.</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./Tehtava-05"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="../Tehtava-04/naive_bayes_batteries.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Naive Bayes -luokittelua akkujärjestelmille</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="rfc_model.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Random Forest Classifier</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By TE-team<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>