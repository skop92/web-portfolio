
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Asennusmäärän ennustaminen &#8212; Solar panel data project</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Asennusmäärän ennustaminen vertaamalla vuoden takaiseen" href="../../Tehtava-05/asennusten_aikasarjaennustus_valikoitu.html" />
    <link rel="prev" title="Asennusmäärän ennustaminen" href="../70-Jupyter-Book/aikasarja.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Solar panel data project</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../70-Jupyter-Book/index.html">
                    Solar panel data project
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Data-analyysi
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../Tehtava-03/paneelivalmistaja_asentaja_visualisointi.html">
   Valmistajat ja asentajat
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Tehtava-03/esik_total_installed_price.html">
   Hintojen tutkiminen
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Tehtava-03/price_trends.html">
   Hintakehitys
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Tehtava-03/esik_system_size_DC.html">
   Sähkötehon tutkiminen
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Tehtava-03/system_size_trend.html">
   Sähkötehon kehitys
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../70-Jupyter-Book/kartat.html">
   Karttalinkit
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Tehtava-03/solar_panel_technologies.html">
   Aurinkopaneeleiden teknologiat
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Esikäsittelijä
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../40-Datan-kuvaus-ja-esik%C3%A4sittely/preprocessor_dokumentointi.html">
   Esikäsittelijän dokumentaatio
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../70-Jupyter-Book/esikasittelijan_testit.html">
   Esikäsittelijän testit
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../tests/self_defined_cols_test.html">
     Itse määritellyt sarakkeet
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../tests/price_preprocessor_test.html">
     Asennuksen hinta
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../tests/size_preprocessor_test.html">
     Järjestelmän sähköteho
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Koneoppiminen
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../70-Jupyter-Book/akkuluokittelu.html">
   Akkuluokittelu
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../Tehtava-04/naive_bayes_batteries.html">
     Naive Bayes -luokittelua akkujärjestelmille
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../Tehtava-05/battery_classification.html">
     Usean mallin luokittelua akkujärjestelmille
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../Tehtava-05/rfc_model.html">
   Random Forest Classifier
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../Tehtava-05/ML_analyysi.html">
     Aurinkopaneli pisteytys koneoppimisen haasteet.
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Tehtava-05/klusteroinnin_analysointia.html">
   Asennusten maantieteellinen klusterointi
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../70-Jupyter-Book/aikasarja.html">
   Asennusmäärän ennustaminen
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Asennusmäärän ennustaminen
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../Tehtava-05/asennusten_aikasarjaennustus_valikoitu.html">
     Asennusmäärän ennustaminen vertaamalla vuoden takaiseen
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Malli tuotantoon
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../Tehtava-06/mallit_tuotantoon.html">
   Mallit tuotantoon
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../70-Jupyter-Book/mercury_src.html">
   Mercury lähdekoodit
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../Tehtava-06/Mercury_clustering.html">
     Mercury clustering
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../Tehtava-06/Mercury_RFC_SPC.html">
     ML test GUI for Random Forest Classifier
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/docs/50-Koneoppiminen/asennusten_aikasarjaennustus_final.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/docs/50-Koneoppiminen/asennusten_aikasarjaennustus_final.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#kirjastot">
   Kirjastot
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#esikasittelijan-ajaminen">
   Esikäsittelijän ajaminen
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#esikasittely-jatkuu">
   Esikäsittely jatkuu
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#luodaan-aikasarja">
     Luodaan aikasarja
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#muokataan-ja-valitaan-data-mallia-varten">
     Muokataan ja valitaan data mallia varten
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#malli">
   Malli
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#funktio-jolla-muodostetaan-mallille-annettava-syote-ja-odotettu-tulos-input-ja-output">
     Funktio, jolla muodostetaan mallille annettava syöte ja odotettu tulos (input ja output)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#train-test-split-maaritys">
     Train test split määritys
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#train-test-split">
     Train test split
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#mallien-koulutus-ja-ennuste">
     Mallien koulutus ja ennuste
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#tulosten-piirto">
   Tulosten piirto
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#virheen-laskenta">
   Virheen laskenta
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Asennusmäärän ennustaminen</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#kirjastot">
   Kirjastot
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#esikasittelijan-ajaminen">
   Esikäsittelijän ajaminen
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#esikasittely-jatkuu">
   Esikäsittely jatkuu
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#luodaan-aikasarja">
     Luodaan aikasarja
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#muokataan-ja-valitaan-data-mallia-varten">
     Muokataan ja valitaan data mallia varten
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#malli">
   Malli
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#funktio-jolla-muodostetaan-mallille-annettava-syote-ja-odotettu-tulos-input-ja-output">
     Funktio, jolla muodostetaan mallille annettava syöte ja odotettu tulos (input ja output)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#train-test-split-maaritys">
     Train test split määritys
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#train-test-split">
     Train test split
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#mallien-koulutus-ja-ennuste">
     Mallien koulutus ja ennuste
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#tulosten-piirto">
   Tulosten piirto
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#virheen-laskenta">
   Virheen laskenta
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="asennusmaaran-ennustaminen">
<h1>Asennusmäärän ennustaminen<a class="headerlink" href="#asennusmaaran-ennustaminen" title="Permalink to this headline">#</a></h1>
<p>Käytetään koneoppimismalleja aurinkopaneelien asennusmäärän ennustamiseen aikasarjalla. Aluksi luodaan aikasarja, jossa on oletuksena kuukausittaiset asennusmäärät, jotka voidaan korvata myös viikoittaisilla määrillä.</p>
<p>Ennusteen tekemistä varten määritetään mallin syötteen ja ennusteen pituus aika-askelina. Ennuste tehdään syötettä seuraaville aika-askelille. Ennusteen pituus vaikuttaa myös opetusaineiston pituuteen, sillä yhtään ennustettavaa arvoa ei haluta sisällyttää opetusaineiston aikasarjoihin.</p>
<p>Käytettävä data on mahdollista rajoittaa halutulle aikavälille. Ennuste tehdään aina valitun aikavälin loppupäähän. Alkupään datapisteitä käytetään opetusaineistona.</p>
<section id="kirjastot">
<h2>Kirjastot<a class="headerlink" href="#kirjastot" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.dates</span> <span class="k">as</span> <span class="nn">mdates</span>
<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="kn">import</span> <span class="nn">importlib.util</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">file_path</span> <span class="o">=</span> <span class="s2">&quot;../../Tehtava-03/preprocessor.py&quot;</span><span class="p">;</span> <span class="n">module_name</span> <span class="o">=</span> <span class="s2">&quot;preprocessor&quot;</span><span class="p">;</span> <span class="n">spec</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">spec_from_file_location</span><span class="p">(</span><span class="n">module_name</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span>
<span class="n">esik</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">module_from_spec</span><span class="p">(</span><span class="n">spec</span><span class="p">);</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">module_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">esik</span><span class="p">;</span> <span class="n">spec</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">exec_module</span><span class="p">(</span><span class="n">esik</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="esikasittelijan-ajaminen">
<h2>Esikäsittelijän ajaminen<a class="headerlink" href="#esikasittelijan-ajaminen" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">customer_segment</span> <span class="o">=</span> <span class="s1">&#39;customer_segment&#39;</span>
<span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;installation_date&#39;</span><span class="p">,</span> <span class="n">customer_segment</span><span class="p">]</span>
<span class="n">df_all</span> <span class="o">=</span> <span class="n">esik</span><span class="o">.</span><span class="n">esik</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="esikasittely-jatkuu">
<h2>Esikäsittely jatkuu<a class="headerlink" href="#esikasittely-jatkuu" title="Permalink to this headline">#</a></h2>
<section id="luodaan-aikasarja">
<h3>Luodaan aikasarja<a class="headerlink" href="#luodaan-aikasarja" title="Permalink to this headline">#</a></h3>
<p>Aikasarjan indeksinä on oletuksena kuukausi ja arvona kaikkien kyseisen kuukauden aikana tehtyjen asennusten määrä valitussa asiakassegmentissä. Merkitään myös nollat.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df_all</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="c1"># Valitaan tarkasteltava asiakasryhmä</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">customer_segment</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;RES&#39;</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="n">customer_segment</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Aika-askel</span>
<span class="n">freq</span> <span class="o">=</span> <span class="s1">&#39;M&#39;</span>  <span class="c1"># Voi olla myös &#39;W&#39;</span>
<span class="n">time_format</span> <span class="o">=</span> <span class="s1">&#39;%Y-%m&#39;</span>  <span class="c1"># Vaihdetaan &#39;%Y-%W&#39;, jos käsitellään viikottaista asennusmäärää</span>

<span class="c1"># Lasketaan asennukset</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;time_step&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;installation_date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">time_format</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;time_step&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;time_step&#39;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="n">df</span><span class="p">})</span>

<span class="c1"># Tavoiteltava indeksi</span>
<span class="n">index_period</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">period_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="s1">&#39;1998-01-01&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;2019-12-29&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="n">freq</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">time_format</span><span class="p">)</span>
<span class="n">period</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">index_period</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;time_step&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;object&#39;</span><span class="p">)</span>
<span class="n">index_period</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">period_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="s1">&#39;1998-01-01&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;2019-12-29&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="n">freq</span><span class="p">)</span>

<span class="c1"># Yhdistetään ja lisätään nollat</span>
<span class="n">df_time_serie</span> <span class="o">=</span> <span class="n">period</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;time_step&#39;</span><span class="p">)</span>
<span class="n">df_time_serie</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_time_serie</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">index_period</span>
<span class="n">df_time_serie</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;time_step&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">df_time_serie</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1998-01</th>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1998-02</th>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1998-03</th>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1998-04</th>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1998-05</th>
      <td>2.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
    </tr>
    <tr>
      <th>2019-08</th>
      <td>13571.0</td>
    </tr>
    <tr>
      <th>2019-09</th>
      <td>13073.0</td>
    </tr>
    <tr>
      <th>2019-10</th>
      <td>13019.0</td>
    </tr>
    <tr>
      <th>2019-11</th>
      <td>13405.0</td>
    </tr>
    <tr>
      <th>2019-12</th>
      <td>14731.0</td>
    </tr>
  </tbody>
</table>
<p>264 rows × 1 columns</p>
</div></div></div>
</div>
</section>
<section id="muokataan-ja-valitaan-data-mallia-varten">
<h3>Muokataan ja valitaan data mallia varten<a class="headerlink" href="#muokataan-ja-valitaan-data-mallia-varten" title="Permalink to this headline">#</a></h3>
<p>Tässä vaiheessa valitaan data määrittämällä aikaväli. Valinta määrää käytännössä opetusaineiston alkupisteen ja ennusteen loppupisteen.</p>
<p>Samalla valitaan mallin käyttämän syötteen ja tehtävän ennusteen pituus, joka määritetään aika-askelina.</p>
<p>Edellisten valintojen tekemisen jälkeen piirretään asennusmäärien kuvaaja. Tarkkojen määrien ohella kuvaan piirretään myös eksponentiaalisesti painotettu keskiarvo sekä liukuva keskiarvo. Niiden avulla asennusmäärien arvojen vaihtelu tasautuu jonkin verran peräkkäisten aika-askelten välillä, mikä todennäköisesti parantaa trendin ennustettavuutta.</p>
<p>Piirtämisen jälkeen tehdään valinta mitä käyrää käytetään mallin datana.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="s1">&#39;1998-01-01&#39;</span>
<span class="n">end</span> <span class="o">=</span> <span class="s1">&#39;2019-12-29&#39;</span>

<span class="n">input_len</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">output_len</span> <span class="o">=</span> <span class="mi">6</span>

<span class="c1"># Vertailuarvot</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df_time_serie</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;ewm_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ewm</span><span class="p">(</span><span class="n">com</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;rolling_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="c1"># Rajaus</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">start</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">time_format</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">end</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">time_format</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">a</span><span class="p">:</span><span class="n">b</span><span class="p">,:]</span>

<span class="c1"># Piirto</span>

<span class="c1"># Varaudutaan käyttämään myös alueen ylittävää päiväystä kuvassa</span>
<span class="n">x_ticks_range</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">period_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;2023-12-01&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="n">freq</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">time_format</span><span class="p">)</span>
<span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">format_date</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="n">thisind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
  <span class="c1">#return df.index[thisind]</span>
  <span class="k">return</span> <span class="n">x_ticks_range</span><span class="p">[</span><span class="n">thisind</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;count&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;ewm_count&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;ewm&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;rolling_count&#39;</span><span class="p">],</span>  <span class="n">label</span><span class="o">=</span><span class="s1">&#39;rolling&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">N</span> <span class="o">&gt;</span> <span class="mi">24</span><span class="p">:</span>
  <span class="n">locator</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">AutoDateLocator</span><span class="p">(</span><span class="n">minticks</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">maxticks</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">locator</span><span class="p">)</span>
  <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">format_date</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
  <span class="n">fig</span><span class="o">.</span><span class="n">autofmt_xdate</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/asennusten_aikasarjaennustus_final_7_0.png" src="../../_images/asennusten_aikasarjaennustus_final_7_0.png" />
</div>
</div>
<p>Valitaan liukuva keskiarvo, koska se seuraa paremmin oikeaa käyrää ja pyöristää vaihteluita jonkin verran. Sarakkeen nimeksi vaihdetaan <code class="docutils literal notranslate"><span class="pre">x_0</span></code>, mikä selkeyttää datan käyttöä mallissa.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#df[&#39;x_0&#39;] = df[&#39;count&#39;]</span>
<span class="c1">#df[&#39;x_0&#39;] = df[&#39;ewm_count&#39;]</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;x_0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;rolling_count&#39;</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="s1">&#39;ewm_count&#39;</span><span class="p">,</span> <span class="s1">&#39;rolling_count&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_ML</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;df_ML.shape:&quot;</span><span class="p">,</span> <span class="n">df_ML</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">df_ML</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>df_ML.shape: (264, 1)
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>x_0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2019-09</th>
      <td>13200.800000</td>
    </tr>
    <tr>
      <th>2019-10</th>
      <td>13559.800000</td>
    </tr>
    <tr>
      <th>2019-11</th>
      <td>13557.000000</td>
    </tr>
    <tr>
      <th>2019-12</th>
      <td>13718.333333</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section id="malli">
<h2>Malli<a class="headerlink" href="#malli" title="Permalink to this headline">#</a></h2>
<p>Muokataan dataa siten, että jokaiselle riville muodostuu syöte ja sen perusteella ennustettavat arvot. Tällöin rivin indeksi ilmaisee vain syötteen ensimmäisen pisteen ajankohdan. Se toisaalta määrää myös muiden syötteen sekä ennusteen pisteiden paikat, joten niille ei tarvitse tehdä mitään.</p>
<section id="funktio-jolla-muodostetaan-mallille-annettava-syote-ja-odotettu-tulos-input-ja-output">
<h3>Funktio, jolla muodostetaan mallille annettava syöte ja odotettu tulos (input ja output)<a class="headerlink" href="#funktio-jolla-muodostetaan-mallille-annettava-syote-ja-odotettu-tulos-input-ja-output" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Source: https://towardsdatascience.com/the-complete-guide-to-time-series-forecasting-using-sklearn-pandas-and-numpy-7694c90e45c1</span>
<span class="k">def</span> <span class="nf">window_input_output</span><span class="p">(</span><span class="n">input_length</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">output_length</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
    
    <span class="n">df</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    
    <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">input_length</span><span class="p">:</span>
        <span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;x_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;x_0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="n">i</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
        
    <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">output_length</span><span class="p">:</span>
        <span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;y_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;x_0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="n">input_length</span><span class="o">-</span><span class="n">j</span><span class="p">)</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span>
        
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">df</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">seq_df</span> <span class="o">=</span> <span class="n">window_input_output</span><span class="p">(</span><span class="n">input_len</span><span class="p">,</span> <span class="n">output_len</span><span class="p">,</span> <span class="n">df_ML</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;seq_df.shape:&quot;</span><span class="p">,</span> <span class="n">seq_df</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">seq_df</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>seq_df.shape: (253, 12)
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>x_0</th>
      <th>x_1</th>
      <th>x_2</th>
      <th>x_3</th>
      <th>x_4</th>
      <th>x_5</th>
      <th>y_0</th>
      <th>y_1</th>
      <th>y_2</th>
      <th>y_3</th>
      <th>y_4</th>
      <th>y_5</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2018-10</th>
      <td>11155.2</td>
      <td>11105.2</td>
      <td>10993.6</td>
      <td>10681.2</td>
      <td>10552.2</td>
      <td>10677.2</td>
      <td>10589.2</td>
      <td>11243.8</td>
      <td>11912.0</td>
      <td>12438.0</td>
      <td>12692.0</td>
      <td>13200.800000</td>
    </tr>
    <tr>
      <th>2018-11</th>
      <td>11105.2</td>
      <td>10993.6</td>
      <td>10681.2</td>
      <td>10552.2</td>
      <td>10677.2</td>
      <td>10589.2</td>
      <td>11243.8</td>
      <td>11912.0</td>
      <td>12438.0</td>
      <td>12692.0</td>
      <td>13200.8</td>
      <td>13559.800000</td>
    </tr>
    <tr>
      <th>2018-12</th>
      <td>10993.6</td>
      <td>10681.2</td>
      <td>10552.2</td>
      <td>10677.2</td>
      <td>10589.2</td>
      <td>11243.8</td>
      <td>11912.0</td>
      <td>12438.0</td>
      <td>12692.0</td>
      <td>13200.8</td>
      <td>13559.8</td>
      <td>13557.000000</td>
    </tr>
    <tr>
      <th>2019-01</th>
      <td>10681.2</td>
      <td>10552.2</td>
      <td>10677.2</td>
      <td>10589.2</td>
      <td>11243.8</td>
      <td>11912.0</td>
      <td>12438.0</td>
      <td>12692.0</td>
      <td>13200.8</td>
      <td>13559.8</td>
      <td>13557.0</td>
      <td>13718.333333</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="train-test-split-maaritys">
<h3>Train test split määritys<a class="headerlink" href="#train-test-split-maaritys" title="Permalink to this headline">#</a></h3>
<p>Selvyyden vuoksi tehdään vain yksi ennustus, eli määritetään testirivien määräksi yksi. Koska kyseessä on testaus, ennustetta ei vielä tehdä tulevaisuuteen, vaan datan loppupäähän. Siksi valitaan viimeinen rivi.</p>
<p>Tavoitteena on, että yhtään ennustettavaa arvoa ei päädy opetusaineistoon. Tässä testissä ne ovat käytännössä testirivin <code class="docutils literal notranslate"><span class="pre">y</span></code>-arvot. Samat arvot toistuvat osittain edellisillä riveillä siten, että edellisellä rivillä on aina yksi ennustettava arvo vähemmän. Arvot voidaan siis karsia opetusaineistosta vähentämällä ennustettavien pisteiden verran rivejä äsken muodostetusta datasta. Tämä voidaan tarkistaa tulostamalla opetusaineiston viimeinen rivi ja ensimmäinen karsittu rivi. Huomataan, että karsitun rivin viimeinen <code class="docutils literal notranslate"><span class="pre">y</span></code>-arvo on sama kuin testirivin ensimmäinen ennustettava arvo.</p>
<p>Tämän jälkeen tiedämme, että mallia voitaisiin käyttää myös tulevaisuuden ennustamiseen testauksen lisäksi.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_size</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">train_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">seq_df</span><span class="p">)</span> <span class="o">-</span> <span class="n">output_len</span>

<span class="c1"># Viimeinen opetusaineistoon mukaan tuleva rivi</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">seq_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">train_size</span><span class="p">,</span> <span class="p">:]</span>
<span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

<span class="c1"># Ensimmäinen karsittu</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">seq_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_size</span><span class="p">:,</span> <span class="p">:]</span>
<span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>x_0</th>
      <th>x_1</th>
      <th>x_2</th>
      <th>x_3</th>
      <th>x_4</th>
      <th>x_5</th>
      <th>y_0</th>
      <th>y_1</th>
      <th>y_2</th>
      <th>y_3</th>
      <th>y_4</th>
      <th>y_5</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2018-07</th>
      <td>10700.6</td>
      <td>10882.8</td>
      <td>11114.8</td>
      <td>11155.2</td>
      <td>11105.2</td>
      <td>10993.6</td>
      <td>10681.2</td>
      <td>10552.2</td>
      <td>10677.2</td>
      <td>10589.2</td>
      <td>11243.8</td>
      <td>11912.0</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>x_0</th>
      <th>x_1</th>
      <th>x_2</th>
      <th>x_3</th>
      <th>x_4</th>
      <th>x_5</th>
      <th>y_0</th>
      <th>y_1</th>
      <th>y_2</th>
      <th>y_3</th>
      <th>y_4</th>
      <th>y_5</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2018-08</th>
      <td>10882.8</td>
      <td>11114.8</td>
      <td>11155.2</td>
      <td>11105.2</td>
      <td>10993.6</td>
      <td>10681.2</td>
      <td>10552.2</td>
      <td>10677.2</td>
      <td>10589.2</td>
      <td>11243.8</td>
      <td>11912.0</td>
      <td>12438.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="train-test-split">
<h3>Train test split<a class="headerlink" href="#train-test-split" title="Permalink to this headline">#</a></h3>
<p>Seuraavaksi tehdään varsinainen aineiston jako opetusaineistoon ja testiaineistoon. Jako tehdään niin rivien kuin sarakkeidenkin mukaan.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">seq_df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;x_&#39;</span><span class="p">)]</span>
<span class="n">y_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">seq_df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;y_&#39;</span><span class="p">)]</span>

<span class="n">X_train</span> <span class="o">=</span> <span class="n">seq_df</span><span class="p">[</span><span class="n">X_cols</span><span class="p">][:</span><span class="n">train_size</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">seq_df</span><span class="p">[</span><span class="n">y_cols</span><span class="p">][:</span><span class="n">train_size</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="n">X_test</span> <span class="o">=</span> <span class="n">seq_df</span><span class="p">[</span><span class="n">X_cols</span><span class="p">][</span><span class="o">-</span><span class="n">test_size</span><span class="p">:]</span><span class="o">.</span><span class="n">values</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">seq_df</span><span class="p">[</span><span class="n">y_cols</span><span class="p">][</span><span class="o">-</span><span class="n">test_size</span><span class="p">:]</span><span class="o">.</span><span class="n">values</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="mallien-koulutus-ja-ennuste">
<h3>Mallien koulutus ja ennuste<a class="headerlink" href="#mallien-koulutus-ja-ennuste" title="Permalink to this headline">#</a></h3>
<p>Käytetään kolmea malllia.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dt_seq</span> <span class="o">=</span> <span class="n">DecisionTreeRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
<span class="n">dt_seq</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">dt_seq_preds</span> <span class="o">=</span> <span class="n">dt_seq</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="n">rf_seq</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
<span class="n">rf_seq</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">rf_seq_preds</span> <span class="o">=</span> <span class="n">rf_seq</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="n">lr_seq</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
<span class="n">lr_seq</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">lr_seq_preds</span> <span class="o">=</span> <span class="n">lr_seq</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="tulosten-piirto">
<h2>Tulosten piirto<a class="headerlink" href="#tulosten-piirto" title="Permalink to this headline">#</a></h2>
<p>Piirretään kuvaajaan saadut tulokset. Syöte on molemmille malleille sama.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">input_len</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">input_len</span> <span class="o">+</span> <span class="n">output_len</span>
<span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">seq_df</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">format_date_2</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="n">thisind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x1</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">x_ticks_range</span><span class="p">[</span><span class="n">N</span> <span class="o">-</span> <span class="n">test_size</span> <span class="o">+</span> <span class="n">thisind</span><span class="p">]</span>

<span class="c1"># Piirto</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dt_seq_preds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;^&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Decision Tree&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">rf_seq_preds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Random Forest&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lr_seq_preds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Linear Regression&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">y_test</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Actual&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">X_test</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;input&#39;</span><span class="p">)</span>

<span class="n">locator</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">AutoDateLocator</span><span class="p">(</span><span class="n">minticks</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">maxticks</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">locator</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">format_date_2</span><span class="p">)</span>
<span class="c1">#fig.autofmt_xdate()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Päivämäärä (vvvv-kk)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Asennusten määrä&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Syöte, ennusteet ja toteutuneet määrät&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/asennusten_aikasarjaennustus_final_20_0.png" src="../../_images/asennusten_aikasarjaennustus_final_20_0.png" />
</div>
</div>
<p>Lienee sattumaa, että <code class="docutils literal notranslate"><span class="pre">Decision</span> <span class="pre">Tree</span></code> pärjäsi tässä testissä hyvin, kun taas <code class="docutils literal notranslate"><span class="pre">Random</span> <span class="pre">Forest</span></code> tekee aivan toisenlaisen skenaarion. Muutamien testien perusteella (jotka eivät näy tässä työkirjassa) <code class="docutils literal notranslate"><span class="pre">Decision</span> <span class="pre">Tree</span></code> reagoi voimakkaammin syötteeseen. <code class="docutils literal notranslate"><span class="pre">Random</span> <span class="pre">Forest</span></code> tekee ennusteensa ikään kuin maltillisemmin koko opetusaineiston pohjalta.</p>
<p>Alla vielä ennusteiden arvot taulukkona.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
  <span class="s1">&#39;Actual&#39;</span><span class="p">:</span> <span class="n">y_test</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
  <span class="s1">&#39;Decision Tree&#39;</span><span class="p">:</span> <span class="n">dt_seq_preds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
  <span class="s1">&#39;Random Forest&#39;</span><span class="p">:</span> <span class="n">rf_seq_preds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
  <span class="s1">&#39;Linear Regression&#39;</span><span class="p">:</span> <span class="n">lr_seq_preds</span><span class="p">[</span><span class="mi">0</span><span class="p">]},</span>
  <span class="n">index</span><span class="o">=</span><span class="n">df_ML</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="n">output_len</span><span class="p">:])</span>
<span class="n">display</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Actual</th>
      <th>Decision Tree</th>
      <th>Random Forest</th>
      <th>Linear Regression</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2019-07</th>
      <td>12438.000000</td>
      <td>12520.6</td>
      <td>11850.210</td>
      <td>12183.561964</td>
    </tr>
    <tr>
      <th>2019-08</th>
      <td>12692.000000</td>
      <td>12809.6</td>
      <td>12082.780</td>
      <td>12425.044291</td>
    </tr>
    <tr>
      <th>2019-09</th>
      <td>13200.800000</td>
      <td>12629.0</td>
      <td>12092.366</td>
      <td>12763.017736</td>
    </tr>
    <tr>
      <th>2019-10</th>
      <td>13559.800000</td>
      <td>13567.6</td>
      <td>12391.730</td>
      <td>12653.471647</td>
    </tr>
    <tr>
      <th>2019-11</th>
      <td>13557.000000</td>
      <td>13773.8</td>
      <td>12670.350</td>
      <td>12758.865308</td>
    </tr>
    <tr>
      <th>2019-12</th>
      <td>13718.333333</td>
      <td>13689.4</td>
      <td>12780.208</td>
      <td>13008.486310</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="virheen-laskenta">
<h2>Virheen laskenta<a class="headerlink" href="#virheen-laskenta" title="Permalink to this headline">#</a></h2>
<p>Arvioidaan mallien toimivuuttaa tässä testissä laskemalla ennusteen keskimääräinen virhe (mean absolute percentage error, MAPE).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">mape</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
  <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">y_true</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">)</span> <span class="o">/</span> <span class="n">y_true</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">dt_mape</span> <span class="o">=</span> <span class="n">mape</span><span class="p">(</span><span class="n">y_test</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dt_seq_preds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">rf_mape</span> <span class="o">=</span> <span class="n">mape</span><span class="p">(</span><span class="n">y_test</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rf_seq_preds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">lr_mape</span> <span class="o">=</span> <span class="n">mape</span><span class="p">(</span><span class="n">y_test</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lr_seq_preds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># Generate bar plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Decision Tree&#39;</span><span class="p">,</span> <span class="s1">&#39;Random Forest&#39;</span><span class="p">,</span> <span class="s1">&#39;Linear Regression&#39;</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">dt_mape</span><span class="p">,</span> <span class="n">rf_mape</span><span class="p">,</span> <span class="n">lr_mape</span><span class="p">]</span>

<span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Regressor models&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;MAPE (%)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">*</span> <span class="mf">1.1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">value</span> <span class="o">+</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
    
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/asennusten_aikasarjaennustus_final_24_0.png" src="../../_images/asennusten_aikasarjaennustus_final_24_0.png" />
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./docs\50-Koneoppiminen"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="../70-Jupyter-Book/aikasarja.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Asennusmäärän ennustaminen</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../../Tehtava-05/asennusten_aikasarjaennustus_valikoitu.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Asennusmäärän ennustaminen vertaamalla vuoden takaiseen</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By TE-team<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>